(function(){ var isopera = window.navigator.userAgent.toUpperCase().indexOf("OPERA") > -1; function A($){ return document.getElementById($); } function C($, rel){ var _=0,A=0; while($ && $!=rel){ _+=$.offsetLeft; A+=$.offsetTop; $=$.offsetParent; } return[_,A]; } function $($,A){ var _=new RegExp("(^|\\s+)"+A+"(\\s+|$)"); if($.className&&!_.test($.className))$.className+=" "+A; else $.className=A; } function _($,A){ var _=new RegExp("(^|\\s+)"+A+"(\\s+|$)"); if($.className&&_.test($.className)){ $.className=$.className.replace(_," "); $.className=$.className.replace(/^\s+|\s+$/,""); } } function F($,_,A){ if(window.addEventListener)$.addEventListener(_,A,false); else if(window.attachEvent) $.attachEvent("on"+_,function(){ A.call($,window.event); }); } window.addEvent=F; function E($,A){ var _; if(document.defaultView&&document.defaultView.getComputedStyle) _=document.defaultView.getComputedStyle($,null).getPropertyValue(A); else if($.currentStyle){ A=A.replace(/\-(\w)/g,function($,_){ return _.toUpperCase(); }); _=$.currentStyle[A]; } return _; } function B($){ return $.replace(/^\s+|\s+$/,""); } function D($){ if(!window.suggestManager)window.suggestManager=[]; window.suggestManager.push(this); this.config=$; this.dataBuffer={}; this.noResultKeys=[]; this.start(); } D.prototype={ parseData:function(D,G){ var E=["<table class='list'>"],A=this.queryKey.substr(0,1),C=null; C=(A>=0&&A<=9)?"code":(A>="a"&&A<="z")?"pinyin":"name"; this.activeData=D; var B=D.Result.length,$=-1; E.push("<thead><tr><th>" + this.config.cols[0] + "</th><th>" + this.config.cols[1] + "</th><th>" + this.config.cols[2] + "</th><th class='bt'>" + this.config.cols[3] + "</th></tr></thead>"); E.push("<tbody>"); var tc = 0; while(++$<B){ var bcd = D.Result[$].bcd = D.Result[$].bcd || D.Result[$].code; var _=D.Result[$][C].indexOf(this.queryKey),F=this.queryKey.length; if(!G)if(_==0)D.Result[$][C]="<em>"+D.Result[$][C].substr(0,F)+"</em>"+D.Result[$][C].substr(F); else if(_>0)D.Result[$][C]=D.Result[$][C].substr(0,_)+"<em>"+D.Result[$][C].substr(_,F)+"</em>"+D.Result[$][C].substr(_+F); var isAllow = true; if(app.allows){ isAllow = false; for(var ta = 0; ta < app.allows.length; ta++){ if(D.Result[$].bcd.indexOf(app.allows[ta]) >= 0){ isAllow = true; break; } } }else if(app.disallows){ isAllow = true; for(var tda = 0; tda < app.disallows.length; tda++){ if(D.Result[$].bcd.indexOf(app.disallows[tda]) >= 0){ isAllow = false; break; } } }else{ isAllow = true; } if(isAllow){ ++tc; E.push("<tr><td>",D.Result[$].code, "</td><td>",D.Result[$].name, "</td><td>",D.Result[$].pinyin, "</td><td class='bt'><button key='", bcd ,"'></button>", "</td></tr>"); } } if(tc == 0){ E.shift(); E.unshift("<table class='list hide'>"); } E.push("</tbody>"); E.push("<tfoot><tr><td colspan='4'><p>" + this.config.mostTip + "</p></td></tr></tfoot>"); E.push('</table><p class="info" style="display:none">',this.config.tipInfo,"</p>"); return E.join(""); } ,displayData:function(A,D){ var B=this; function toggle(e){ e = e || window.event; if(e.stopPropagation) e.stopPropagation(); else e.cancelBubble = true; if(this.className === "added"){ removeCustom(this.getAttribute("key")); }else if(this.className === "disabled"){ }else{ addCustom(this.getAttribute("key")); } for(var E=0,C=B.suggestButtons.length; E<C; E++){ var curb = B.suggestButtons[E]; if(hasCustom(curb.getAttribute("key"))){ curb.className = "added"; }else if(app.customs.length>=20){ curb.className = "disabled"; }else{ curb.className = ""; } } if(app.customs.length>=20){ B.noti.className = ""; }else{ B.noti.className = "hide"; } } if(A.Result.length==0){ this.noResultKeys.push(this.queryKey); this.suggestPanel.style.display="none"; this.suggestItems=null; return; } this.dataBuffer[this.queryKey]=A; this.suggestPanel.innerHTML=this.parseData(A,D); this.suggestPanel.style.display="block"; this.suggestButtons = this.suggestPanel.getElementsByTagName("tbody")[0].getElementsByTagName("button"); for(var E=0,C=this.suggestButtons.length; E<C; E++){ var curb = this.suggestButtons[E]; if(hasCustom(curb.getAttribute("key"))){ curb.className = "added"; }else if(app.customs.length>=20){ curb.className = "disabled"; } curb.onclick = toggle; } this.noti = this.suggestPanel.getElementsByTagName("tfoot")[0].getElementsByTagName("p")[0]; if(app.customs.length>=20){ this.noti.className = ""; }else{ this.noti.className = "hide"; } this.suggestItems=this.suggestPanel.getElementsByTagName("tbody")[0].getElementsByTagName("tr"); this.activeItemIndex=-1; for(var E=0,C=this.suggestItems.length; E<C; E++){ this.suggestItems[E].onmouseover=(function(A){ return function(){ try{ _(B.suggestItems[B.activeItemIndex],"cur"); } catch(C){ } $(B.suggestItems[A],"cur"); B.activeItemIndex=A; } })(E); this.suggestItems[E].onclick=(function($){ return function(){ B.suggestPanel.style.display="none"; var A=B.activeData.Result[$].code.replace(/<\/?em>/ig,""),_=B.activeData.Result[$].name; if(B.config.mutipleSupport)B.doMutipleSupport(A+","); else B.config.input.value=A; if(B.config.needSubmitForm){ B.config.input.value=B.config.input.value.replace(/,$/i,""); B.config.form.submit(); } else B.config.form.onsubmit(); } ; })(E); } ; } ,hasNoResult:function(_){ for(var A=0,$=this.noResultKeys.length; A<$; A++) if(_.substr(0,this.noResultKeys[A].length)==this.noResultKeys[A]) return true; return false; } ,getData:function($){ if($ in this.dataBuffer){ this.displayData(this.dataBuffer[$],true); return; } if(this.hasNoResult($)){ this.suggestPanel.style.display="none"; this.suggestItems=null; return; } if(this.dataScript){ this.dataScript.parentNode.removeChild(this.dataScript); this.dataScript=null; } this.dataScript=document.createElement("script"); this.dataScript.setAttribute("type","text/javascript"); this.dataScript.src=this.config.url+$; document.getElementsByTagName("head")[0].appendChild(this.dataScript); } ,doSelect:function(A){ if(!this.suggestItems)return; try{ _(this.suggestItems[this.activeItemIndex],"cur"); } catch(B){} switch(A){ case 40:try{ $(this.suggestItems[++this.activeItemIndex],"cur"); } catch(B){ this.activeItemIndex=-1; } break; case 38:try{ $(this.suggestItems[--this.activeItemIndex],"cur"); } catch(B){ this.activeItemIndex=this.suggestItems.length; } break; } if(this.activeItemIndex>=0&&this.activeItemIndex<this.suggestItems.length)return this.activeData.Result[this.activeItemIndex].code.replace(/<\/?em>/ig,""); return false; } ,doMutipleSupport:function(B,_){ var $=new RegExp(",?[^,]*,?$"),A=this; this.config.input.value=this.config.input.value.replace($,","+B); this.config.input.value=this.config.input.value.replace(/^,/i,""); F(this.config.form,"submit",function(){A.config.input.value=A.config.input.value.replace(/,$/i,"");}); } ,registEvent:function(){ var $=this; this.config.input.onkeydown=function(B){ var B=B||window.event,_=B.keyCode; if(_==40||_==38){ var C=$.doSelect(_); if(C&&$.config.mutipleSupport)$.doMutipleSupport(C+","); else if($.queryKey)$.doMutipleSupport($.queryKey); try{ B.preventDefault(); } catch(A){ } } }; F(this.config.input,"focus",function(){ for(var _=0,$=window.suggestManager.length; _<$; _++)window.suggestManager[_].suggestPanel.style.display="none"; }); this.config.input.onkeyup=function(D){ if(this.value==""){ try{ window.activeSuggest.suggestPanel.style.display="none"; } catch(A){} return; } window.activeSuggest=$; var D=D||window.event,_=D.keyCode; if(_==40||_==38){ try{ D.preventDefault(); } catch(A){} return false; } if(_==13){ window.activeSuggest.suggestPanel.style.display="none"; return; } var E=B(this.value).toLowerCase(); if(E==""){ $.suggestPanel.style.display="none"; return; } $.queryKey=E; if($.config.mutipleSupport)if(E.lastIndexOf(",")!=-1)$.queryKey=E.substr(E.lastIndexOf(",")+1); var C=$.queryKey.replace(/(\..*)$|,$/ig,""); $.getData(C); } } ,createSuggestPanel:function(){ var _=this,$=document.createElement("div"); $.className="suggest_panel"; $.id=this.config.id; if(!this.config.width)$.style.width=this.config.input.offsetWidth+"px"; else $.style.width=this.config.width+"px"; $.style.position="absolute"; $.style.left=(C(this.config.input, document.body)[0] + 1 ) - (isopera ? C(document.body.children[0])[0] + 1 : 0) +"px"; $.style.top=C(this.config.input)[1]+this.config.input.offsetHeight + 1 +"px"; $.style.display="none"; this.suggestPanel=$; document.body.appendChild($); F(window,"resize",function(A){ $.style.left=(C(_.config.input, document.body)[0] + 1 ) - (isopera ? C(document.body.children[0])[0] + 1 : 0) +"px"; $.style.top=C(_.config.input)[1]+_.config.input.offsetHeight + 1 +"px"; }); F(window,"load", function(A){ $.style.left=(C(_.config.input, document.body)[0] + 1 ) - (isopera ? C(document.body.children[0])[0] + 1: 0) +"px"; $.style.top=C(_.config.input)[1]+_.config.input.offsetHeight + 1 +"px"; }); F(window,"scroll",function(A){ $.style.left=(C(_.config.input, document.body)[0] + 1 ) - (isopera ? C(document.body.children[0])[0] + 1 : 0) +"px"; $.style.top=C(_.config.input)[1]+_.config.input.offsetHeight + 1 +"px"; }); } ,start:function(){ this.registEvent(); this.createSuggestPanel(); } }; window.AutoSuggest=D; Baidu=window.Baidu||{}; Baidu.Finance=Baidu.Finance||{}; Baidu.Finance.Suggest=Baidu.Finance.Suggest||{}; Baidu.Finance.Suggest.GetResult=function($){ window.activeSuggest.displayData($); }; F(document,"click",function(_){ var _=_||window.event,$=_.srcElement||_.target; if(window.activeSuggest&&$!=window.activeSuggest.config.input)window.activeSuggest.suggestPanel.style.display="none"; }); F(window,"load",function(){ as1=new D({ form:A("bdsf"), input:A("bdswd"), url:app.sugUrl || "http://cjhq.baidu.com/suggest?code=", id:"suggest1", needSubmitForm:true, width:402, mutipleSupport:true, mostTip:"\u6700\u591A\u53EA\u80FD\u6DFB\u52A020\u6761\u8BB0\u5F55\uFF01", cols:["\u80A1\u7968\u4EE3\u7801", "\u80A1\u7968\u540D\u79F0" , "\u62FC\u97F3", "\u6DFB\u52A0\u81EA\u9009\u80A1"], tipInfo:'\u60a8\u53ef\u4ee5\u7528\u9017\u53f7","\u5206\u5272\u591a\u652f\u80a1\u7968\uff0c\u540c\u65f6\u67e5\u8be2' }); }); })();
